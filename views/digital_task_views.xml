<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <record id="digital_tasks_kanban" model="ir.ui.view">
        <field name="name">digital.tasks.kanban</field>
        <field name="model">digital.task</field>
        <field name="type">kanban</field>
        <field name="priority" eval="100"/>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" default_group_by="state" default_order="date_deadline" archivable="false"
                    sample="1" quick_create="0">
                <field name="name"/>
                <field name="state" default_order="state" readonly="1"/>
                <field name="is_assigned" invisible="1"/>
                <progressbar field="state"
                        colors='{"completed": "success", "in_progress": "warning", "cancelled": "danger","sent_to_approve":"secondary","approved":"info","assigned":"primary","to_post":"warning", "posted":"info"}'/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_content oe_kanban_global_click">
                            <div>
                                <strong class="o_kanban_record_title">
                                    <span>
                                        <field name="name"/>
                                    </span>
                                </strong>
                            </div>
                            <div class="o_kanban_record_body">

                                <span attrs="{'invisible':[('state','in',(False,'1_draft','sent_to_approve','approved','cancelled'))]}">
                                    <b>Assigned To: </b><field name="execs_display"/>
                                    <br/>
                                </span>
                                <span attrs="{'invisible':[('state','not in',('1_draft','sent_to_approve','approved'))]}">
                                    <b>Expected On: </b><field name="expected_date"/>
                                    <br/>
                                </span>
                                <span attrs="{'invisible':[('state','not in',('1_draft','completed','to_post','posted'))]}">
                                    <b>Completed On: </b><field name="date_completed"/>
                                    <br/>
                                </span>
                                <span attrs="{'invisible':[('state','!=','posted')]}">
                                    <b>Posted On: </b><field name="date_posted"/>
                                    <br/>
                                </span>
                                <span attrs="{'invisible':[('state','!=','to_post')]}">
                                    <b>Post Due: </b><field name="date_to_post"/>
                                    <br/>
                                </span>
                                <!-- <br/> -->
<!-- 
                                <field name="assigned_execs" >
                                    <field name="name" widget="many2one_avatar_user"/>
                                </field> -->
                            </div>
                            <div class="o_kanban_record_bottom" t-if="!selection_mode">
                                <div class="oe_kanban_bottom_left" t-if="!selection_mode" attrs="{'invisible':[('state','not in',('assigned','in_progress') )]}">
                                    <span><b>Deadline: </b><field name="date_deadline"/></span>     
                                </div>
                                <div class="oe_kanban_bottom_right" t-if="!selection_mode">
                                    <field name="priority" widget="priority"/>

                                    <!-- <field name="dead_line" widget="remaining_days" attrs="{'invisible': [('state', 'in', ['completed','cancelled'])]}"/> -->

                                    <!--                                <field name="kanban_state" widget="state_selection" groups="base.group_user"-->
                                    <!--                                       invisible="context.get('fsm_mode', False)"/>-->                           '
                                    <field name="task_creator" widget="many2one_avatar_user"/>

                                    <!-- <field name="assigned_execs" >
                                        <field name="name" widget="many2many_tags"/>
                                    </field> -->
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>


    <record id="digital_tasks_form" model="ir.ui.view">
        <field name="name">Digital Tasks</field>
        <field name="model">digital.task</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Form">
                <header>
                    <button name="action_confirm" string="Confirm" help="Click here to confirm the task and sent it to Digital Head for approving" type="object" class="oe_highlight" attrs="{'invisible':[('state','!=','1_draft')]}"/>
                    <button name="action_approve" string="Approve" groups="logic_digital_tracker.group_digital_head" help="Click here to approve the task" type="object" class="oe_highlight" attrs="{'invisible':[('state','!=','sent_to_approve')]}"/>
                    <button name="action_assign" string="Assign Task" groups="logic_digital_tracker.group_digital_head" help="Click here to assign the task to executives" type="object" class="oe_highlight" attrs="{'invisible':[('state','!=','approved')]}"/>
                    <button name="action_in_progress" string="In Progress" groups="logic_digital_tracker.group_digital_head,logic_digital_tracker.group_digital_executive" help="Click here to set the status of task to In Progress" type="object" class="oe_highlight" attrs="{'invisible':[('state','!=','assigned')]}"/>
                    <button name="action_complete" string="Set as Completed" groups="logic_digital_tracker.group_digital_head,logic_digital_tracker.group_digital_executive" help="Click here to set the status of task to Completed" type="object" class="oe_highlight" attrs="{'invisible':[('state','!=','in_progress')]}"/>
                    <button name="action_revert_to_in_progress" string="Revert to In Progress" groups="logic_digital_tracker.group_digital_head" help="Click here to reset the status of task to In Progress" type="object" class="oe_highlight" attrs="{'invisible':[('state','!=','completed')]}"/>
                    <button name="action_send_to_post" string="Send to Post" groups="logic_digital_tracker.group_digital_head" help="Click here to create an activity for Social Media Manager to post" type="object" class="oe_highlight" attrs="{'invisible':[('state','!=','completed')]}"/>
                    <button name="action_social_post" string="Set as Posted" groups="logic_digital_tracker.group_digital_head,logic_digital_tracker.group_social_manager" help="Click here to set status as posted (Usually done by Social Media Manager)" type="object" class="oe_highlight" attrs="{'invisible':[('state','!=','to_post')]}"/>
                    <button name="action_cancel" string="Cancel" help="Click here to cancel the task" type="object" attrs="{'invisible':[('state','not in',('1_draft','sent_to_approve','approved') )]}"/>

                    <field name="state" widget="statusbar" statusbar_visible="1_draft,sent_to_approve,approved,assigned,in_progress,completed,to_post,posted"/>
                </header>
                <sheet>
                    <div class="oe_title pr-0">
                        <h1 class="d-flex flex-row justify-content-between">
                            <field name="name" class="mr-3" placeholder="Task Title..."/>
                            <field name="priority" widget="priority"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="task_type"/>
                            <field name="description"/>
                            <field name="task_head"/>
                            <field name="expected_date"/>
                            <field name="task_creator" readonly="1"/>
                            
                            <field name="tags_ids" widget="many2many_tags"/>
                        </group>
                        <group>
                            <field name="assigned_execs" widget="many2many_tags" readonly="1" attrs="{'invisible':[('state','in',(False,'1_draft','sent_to_approve') )]}"/>
                            <field name="date_assigned" attr="{'invisible':[('date_assigned','=',False)]}" readonly="1"/>
                            <field name="date_deadline" attrs="{'invisible':[('date_deadline','=',False)]}" readonly="1"/>
                            <field name="date_completed" attrs="{'invisible':[('date_completed','=',False)]}" readonly="1"/>
                            <field name="social_manager" attrs="{'invisible':[('social_manager','=',False)]}" readonly="1"/>
                            <field name="date_to_post" attrs="{'invisible':[('date_to_post','=',False)]}"/>
                            <field name="date_posted" attrs="{'invisible':[('date_posted','=',False)]}"/>
                            
                        </group>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids" options="{'post_refresh': 'recipients'}"/>
                </div>

            </form>
        </field>
    </record>

    <record id="view_digital_task_calendar" model="ir.ui.view">
        <field name="name">digital.task.calender</field>
        <field name="model">digital.task</field>
        <field name="type">calendar</field>
        <field name="priority" eval="2"/>
        <field name="arch" type="xml">
            <calendar string="Scheduled Tasks" date_start="date_assigned" date_stop="date_deadline" 
            color="task_type" quick_add="0" mode="month" create="0" delete="0"
            >
                <field name="state" filters="1" invisible="1"/>
                <field name="display_name" invisible="1"/>
                <field name="task_head" filters="1"/>
                <field name="assigned_execs" widget="many2many_tags"/>
                <field name="task_type" filters="1"/>
                <!-- <field name="" filters="1"/> -->
            </calendar>
        </field>
    </record>

    <record id="view_digital_task_tree" model="ir.ui.view">
        <field name="name">digital.task.tree</field>
        <field name="model">digital.task</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="task_type"/>
                <field name="assigned_execs" widget="many2many_tags"/>
                <field name="state"/>
            </tree>

        </field>
    </record>

    <record model="ir.actions.act_window" id="digital_task_action">
        <field name="name">Digital Tasks</field>
        <field name="res_model">digital.task</field>
        <field name="view_mode">kanban,tree,form,calendar</field>
    </record>
    <menuitem name="Digital Tracker" id="menu_digital_tracker"
              action="digital_task_action"
              sequence="9"/>

    <menuitem name="Tasks" id="menu_digital_tasks"
              action="digital_task_action"
              parent="menu_digital_tracker"
              sequence="2"/>
</odoo>